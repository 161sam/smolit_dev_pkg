#!/usr/bin/env bash
# ==============================================================================
#  sd  â€”  smolit_dev CLI (modular)  
#  One-command Dev-Stack: OpenHands (Docker) + MCP (SSE) + Claude & Codex Bridge
#  Requirements: bash, docker, node>=18, curl (jq optional)
#  Cross-platform: Linux, macOS; Windows via Node-Launcher + Git Bash
# ==============================================================================

set -Eeuo pipefail
IFS=$'\n\t'

# ===== Cleanup & Paths =====
cleanup() { :; }
trap cleanup EXIT

SELF_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SELF_DIR/.." && pwd)"

# ===== Load Core Modules =====
source "$ROOT_DIR/lib/core.sh"
source "$ROOT_DIR/lib/config.sh"

# ===== Load All Other Modules =====
for f in "$ROOT_DIR/lib/"*.sh; do
  [[ "$f" =~ /(core|config)\.sh$ ]] || source "$f"
done

# ===== Load Plugins =====
load_plugins "$CONF_DIR/plugins"
load_plugins "$WORKSPACE/.sd/plugins"

# ===== Dispatch =====
sd_dispatch "$@"
